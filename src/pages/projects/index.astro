---
/*
  ============================================================
  PROJECTS INDEX PAGE - projects/index.astro
  Displays all projects with filtering and search functionality.
  ============================================================
*/
import Layout from '../../layouts/Layout.astro';
import ProjectCard from '../../components/ProjectCard.astro';
import { getCollection } from 'astro:content';

// Get all published projects
const allProjects = await getCollection('projects', ({ data }) => {
  return data.draft !== true;
});

// Sort by date (newest first)
const projects = allProjects.sort((a, b) => 
  new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
);

// Extract unique tags for filtering
const allTags = [...new Set(projects.flatMap(project => project.data.tags))].sort();
---

<Layout 
  title="Projects" 
  description="Explore Brian Kim's projects in engineering, business, STEM, and leadership."
>
  <!-- Hero Section -->
  <section class="section bg-gradient-to-b from-gray-50 to-white dark:from-gray-900 dark:to-gray-950">
    <div class="container-custom">
      <div class="max-w-4xl mx-auto text-center">
        <h1 class="text-4xl md:text-5xl font-bold mb-6 text-gray-900 dark:text-white">
          My Projects
        </h1>
        <p class="text-xl text-gray-600 dark:text-gray-300 max-w-2xl mx-auto">
          A collection of my work spanning engineering, business, STEM research, and leadership initiatives.
        </p>
      </div>
    </div>
  </section>
  
  <!-- Projects Section -->
  <section class="section pt-0">
    <div class="container-custom">
      <!-- Filters & Search -->
      <div class="mb-10 space-y-4">
        <!-- Search Bar -->
        <div class="relative max-w-md mx-auto md:mx-0">
          <input
            type="text"
            id="search-input"
            placeholder="Search projects..."
            class="w-full px-4 py-3 pl-12 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all"
            aria-label="Search projects"
          />
          <svg class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
          </svg>
        </div>
        
        <!-- Tag Filters -->
        <div class="flex flex-wrap gap-2 justify-center md:justify-start">
          <button
            class="filter-btn active px-4 py-2 rounded-full text-sm font-medium bg-primary-600 text-white transition-all"
            data-tag="all"
            aria-pressed="true"
          >
            All Projects
          </button>
          {allTags.map((tag) => (
            <button
              class="filter-btn px-4 py-2 rounded-full text-sm font-medium bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 transition-all"
              data-tag={tag}
              aria-pressed="false"
            >
              {tag}
            </button>
          ))}
        </div>
      </div>
      
      <!-- Projects Grid -->
      <div id="projects-grid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
        {projects.map((project) => (
          <div class="project-item" data-tags={JSON.stringify(project.data.tags)} data-title={project.data.title.toLowerCase()} data-description={project.data.description.toLowerCase()}>
            <ProjectCard
              title={project.data.title}
              description={project.data.description}
              slug={project.slug}
              tags={project.data.tags}
              tools={project.data.tools}
              thumbnail={project.data.thumbnail}
              date={project.data.date}
            />
          </div>
        ))}
      </div>
      
      <!-- Empty State -->
      <div id="empty-state" class="hidden text-center py-16">
        <svg class="w-16 h-16 mx-auto mb-4 text-gray-300 dark:text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M12 20a8 8 0 100-16 8 8 0 000 16z" />
        </svg>
        <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">No projects found</h3>
        <p class="text-gray-500 dark:text-gray-400">Try adjusting your search or filter criteria.</p>
      </div>
      
      <!-- Instructions for adding projects -->
      {projects.length === 0 && (
        <div class="text-center py-16">
          <svg class="w-16 h-16 mx-auto mb-4 text-gray-300 dark:text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
          </svg>
          <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">No projects yet</h3>
          <p class="text-gray-500 dark:text-gray-400 mb-4">
            Add your first project by creating a Markdown file in:
          </p>
          <code class="text-sm bg-gray-100 dark:bg-gray-800 px-3 py-2 rounded">
            /src/content/projects/your-project.md
          </code>
        </div>
      )}
    </div>
  </section>
</Layout>

<script>
  // Filter and search functionality
  document.addEventListener('DOMContentLoaded', () => {
    const filterButtons = document.querySelectorAll('.filter-btn');
    const projectItems = document.querySelectorAll('.project-item');
    const searchInput = document.getElementById('search-input') as HTMLInputElement;
    const emptyState = document.getElementById('empty-state');
    
    let currentTag = 'all';
    let searchQuery = '';
    
    function filterProjects() {
      let visibleCount = 0;
      
      projectItems.forEach((item) => {
        const element = item as HTMLElement;
        const tags: string[] = JSON.parse(element.dataset.tags || '[]');
        const title = element.dataset.title || '';
        const description = element.dataset.description || '';
        
        const matchesTag = currentTag === 'all' || tags.includes(currentTag);
        const matchesSearch = searchQuery === '' || 
          title.includes(searchQuery) || 
          description.includes(searchQuery) ||
          tags.some(tag => tag.toLowerCase().includes(searchQuery));
        
        if (matchesTag && matchesSearch) {
          element.style.display = '';
          visibleCount++;
        } else {
          element.style.display = 'none';
        }
      });
      
      // Show/hide empty state
      if (emptyState) {
        emptyState.classList.toggle('hidden', visibleCount > 0);
      }
    }
    
    // Filter button click handler
    filterButtons.forEach((button) => {
      button.addEventListener('click', () => {
        // Update active state
        filterButtons.forEach(btn => {
          btn.classList.remove('active', 'bg-primary-600', 'text-white');
          btn.classList.add('bg-gray-100', 'dark:bg-gray-800', 'text-gray-600', 'dark:text-gray-300');
          btn.setAttribute('aria-pressed', 'false');
        });
        
        button.classList.add('active', 'bg-primary-600', 'text-white');
        button.classList.remove('bg-gray-100', 'dark:bg-gray-800', 'text-gray-600', 'dark:text-gray-300');
        button.setAttribute('aria-pressed', 'true');
        
        currentTag = (button as HTMLElement).dataset.tag || 'all';
        filterProjects();
      });
    });
    
    // Search input handler
    if (searchInput) {
      searchInput.addEventListener('input', (e) => {
        searchQuery = (e.target as HTMLInputElement).value.toLowerCase();
        filterProjects();
      });
    }
  });
</script>
